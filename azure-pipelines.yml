trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- checkout: self
  persistCredentials: true  # Secure repo access

- script: |
    echo "Security Scan: Check permissions"
    find . -type f ! -perm 644 -exec ls -la {} ; 2>/dev/null || true
    echo "Disk audit from Linux project."
    cat final_report_*.txt | head -10
  displayName: 'Run Linux Security Audit'

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(Pipeline.Workspace)/final_report_*.txt'
    artifact: 'SecurityReports'
    publishLocation: 'pipeline'
  displayName: 'Publish Audit Reports'
